<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Server Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="stars"></div>
    <div class="twinkling"></div>

    <header class="main-header">
        <div class="logo">TEAM ZEROIX</div>
        <div class="header-title">CREATE SERVER PANEL</div>
        <div class="profile-icon"><i class="fas fa-user-circle"></i></div>
    </header>

    <div class="container">
        
        <form id="createServerForm">
            
            <label>Tipe Server:</label>
            <div class="server-type-options">
                <input type="radio" id="type_private" name="panelType" value="private" required checked>
                <label for="type_private">Private</label>
                
                <input type="radio" id="type_public" name="panelType" value="public" required>
                <label for="type_public">Public</label>
            </div>

            <label for="serverName">Nama Server:</label>
            <input type="text" id="serverName" name="serverName" placeholder="Contoh: MyNodeApp" required>

            <label for="ram">Pilih RAM:</label>
            <select id="ram" name="ram" required>
                </select>

            <div id="secretKeyContainer">
                <label for="secretKey">Secret Key:</label>
                <input type="password" id="secretKey" name="secretKey" placeholder="Masukkan Secret Anda">
                <small>Khusus anggota Zeroix. Dapatkan di zeroix.id/zeroix/key</small>
            </div>
            
            <button type="submit" id="submitButton">Buat Server</button>
        </form>

        <div id="result"></div>
    </div>

    <a href="https://wa.me/6285161603561" class="whatsapp-fab" target="_blank" aria-label="Chat on WhatsApp">
        <i class="fab fa-whatsapp"></i>
    </a>
    
    <div id="realtime-clock">
        <span id="clock-time">00:00:00</span>
    </div>

    <script>
        // --- Definisi Elemen ---
        const panelTypeRadios = document.querySelectorAll('input[name="panelType"]');
        const secretKeyContainer = document.getElementById('secretKeyContainer');
        const secretKeyInput = document.getElementById('secretKey');
        const submitButton = document.getElementById('submitButton');
        const form = document.getElementById('createServerForm');
        const ramSelect = document.getElementById('ram');
        const resultDiv = document.getElementById('result');

        // --- Opsi RAM (sesuai permintaan baru 1-9GB, 10=Unlimited) ---
        const newRamOptions = [
            { value: "1024", text: "1 GB (1024 MB)" },
            { value: "2048", text: "2 GB (2048 MB)" },
            { value: "3072", text: "3 GB (3072 MB)" },
            { value: "4096", text: "4 GB (4096 MB)" },
            { value: "5120", text: "5 GB (5120 MB)" },
            { value: "6144", text: "6 GB (6144 MB)" },
            { value: "7168", text: "7 GB (7168 MB)" },
            { value: "8192", text: "8 GB (8192 MB)" },
            { value: "9216", text: "9 GB (9216 MB)" },
            { value: "0",    text: "10 GB (Unlimited)" } // Nilai "0" berarti unlimited
        ];

        const ramOptions = {
            private: newRamOptions,
            public: newRamOptions // Sekarang opsi Private dan Public SAMA
        };

        // --- Fungsi untuk update pilihan RAM ---
        function updateRamOptions(type) {
            const options = ramOptions[type];
            const currentValue = ramSelect.value;
            
            ramSelect.innerHTML = '<option value="" disabled>-- Pilih Ukuran RAM --</option>'; // Reset

            options.forEach(opt => {
                const optionEl = document.createElement('option');
                optionEl.value = opt.value;
                optionEl.textContent = opt.text;
                ramSelect.appendChild(optionEl);
            });

            // Setel ulang nilai sebelumnya jika masih valid, jika tidak, reset
            if (options.some(opt => opt.value === currentValue)) {
                ramSelect.value = currentValue;
            } else {
                ramSelect.value = ""; 
            }
        }

        // --- Fungsi untuk ganti tampilan form ---
        function togglePanelType() {
            const selectedType = document.querySelector('input[name="panelType"]:checked').value;
            
            if (selectedType === 'private') {
                secretKeyContainer.style.display = 'block';
                secretKeyInput.required = true;
                submitButton.innerText = 'Buat Server Privat';
            } else { // public
                secretKeyContainer.style.display = 'none';
                secretKeyInput.required = false;
                secretKeyInput.value = ''; // Kosongkan nilainya
                submitButton.innerText = 'Buat Server Publik';
            }
            
            // Perbarui juga opsi RAM
            updateRamOptions(selectedType);
        }

        // Tambahkan event listener ke radio buttons
        panelTypeRadios.forEach(radio => radio.addEventListener('change', togglePanelType));
        
        // Panggil sekali saat halaman dimuat
        togglePanelType();

        // --- Logika Submit Form ---
        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            
            submitButton.disabled = true;
            resultDiv.className = '';
            resultDiv.innerText = '⏳ Membuat server, mohon tunggu...';

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            data.ram = parseInt(data.ram, 10);

            try {
                // Perhatikan: path API adalah '/api/create'
                const response = await fetch('/api/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                });

                const responseData = await response.json();

                if (!response.ok) {
                    throw new Error(responseData.error || 'Terjadi kesalahan');
                }
                
                resultDiv.className = 'success';
                resultDiv.innerHTML = `
                    <h4>✅ Semua Berhasil Disiapkan!</h4>
                    <p><strong>URL Panel:</strong> ${responseData.panelURL}</p><hr>
                    <p><strong>Username:</strong> ${responseData.user.username}</p>
                    <p><strong>Email:</strong> ${responseData.user.email}</p>
                    <p><strong>Password:</strong> ${responseData.password}</p><hr>
                    <p><strong>Nama Server:</strong> ${responseData.server.name}</p>
                    <p><strong>RAM:</strong> ${data.ram === 0 ? 'Unlimited' : (responseData.server.limits.memory + ' MB')}</p>
                `;
                form.reset();
                togglePanelType(); // Reset tampilan form ke default

            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.innerText = `❌ Gagal: ${error.message}`;
            } finally {
                submitButton.disabled = false;
            }
        });

        // --- Logika Jam ---
        function updateClock() {
            const clockElement = document.getElementById('clock-time');
            if (clockElement) {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                clockElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }
        setInterval(updateClock, 1000);
        updateClock();
    </script>
</body>
</html>
